<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess 2 -  Lobby</title>
    <script src="/src/variables.js"></script>
    <script src="/src/components/piecesComponent.js"></script>

    <script src="/src/components/galleryComponent.js"></script>

    <script src="/socket.io/socket.io.js"></script>

    <link rel="stylesheet" href="/src/main.css">

    <script>
        let raceWhite = 'classic';
        let raceBlack = 'classic';
        const cleanSelect = function(selected,removedClass, race){
            var elems = document.querySelectorAll("."+removedClass);
            [].forEach.call(elems, function(el) {
                el.classList.remove(removedClass);
            });
            selected.classList.add(removedClass)

            if(removedClass === 'racePickImageSelectedWhite'){
                raceWhite = race;
            }
            else{
                raceBlack = race;
            }
        }

        const hotseatGameStart = function(){
            window.location.href = `/hotseat?whiteRace=${raceWhite}&blackRace=${raceBlack}`
        }
    </script>


<!-- istinski kod-->
    <script>
        const socket = io();
        
        let gameMode = 'raceChoiceChess'

        function selectMode(el,mode){
            gameMode = mode;
            let elems = document.querySelectorAll(".gameModeSelected");
            
            elems.forEach(function(el) {
                el.classList.remove("gameModeSelected");
                el.classList.add('gameMode')
            });
            el.classList.remove("gameMode");

            el.classList.add('gameModeSelected')
        }   
        socket.on('rooms', (data)=>{
                let gamesHTML = document.getElementById('games');
                gamesHTML.innerHTML = ``
                data.forEach((el,index) => {
                    gamesHTML.innerHTML += `
                    <div class="lobbyGame"> <a class="linkHeader"  href="/play?roomId=${el.roomId}">${el.roomId}</a>
                            <div class="row">
                                <span class="span"> ${el.players.length} / 2 players</span>
                            </div>
                            <div class="row"> 
                            <a class="startGame" href="/play?roomId=${el.roomId}">Start Game</a>
                            </div>
                        
                    </div>
                            `
                })
                if(data.length == 0){
                    gamesHTML.innerHTML = `<h1>No Games Available</h1>`
                }

        })

        fetch('/allgames').then((data) => {
            let gamesHTML = document.getElementById('games');
                gamesHTML.innerHTML = ``
                data.json().then((data) => {
                    data.forEach((el,index) => {
                    gamesHTML.innerHTML += `
                    <div class="lobbyGame"> <a class="linkHeader"  href="/play?roomId=${el.roomId}">${el.roomId}</a>
                            <div class="row">
                                <span class="span"> ${el.players.length} / 2 players</span>
                            </div>
                            <div class="row"> 
                            <a class="startGame" href="/play?roomId=${el.roomId}">Start Game</a>
                            </div>
                        
                    </div>
                            `
                    })
                    if(data.length == 0){
                        gamesHTML.innerHTML = `<h1>No Games Available</h1>`
                    }
                })
                    
                // console.log(data.json())

        })
        let wsc = whiteSquareColor
        // console.log(wsc)

        let startNewGame = function(){
            let gameName = document.getElementById('gameName').value
            window.location.replace(`/play?roomId=${gameName}&mode=${gameMode}`)
        }


    </script>
</head>
<body>
<div class="topMenu">
    <gallery-game selected="1" background="#ffffff" class="gallery" headings='["Create Game", "Join Game","Hotseat",  "Pieces" ]'>
        <div>
            <div class="column">
                <input type="text" id="gameName" placeholder="Game Name">
                <!-- <h3 class="cWhite">Game Mode</h3> -->
                <!-- <div><h1 id="raceChoiceChess" onclick="selectMode(this,'raceChoiceChess')" class="gameModeSelected">Chess 2</h1></div>
                <div><h1 id="minichess" onclick="selectMode(this,'minichess')" class="gameMode">Minichess</h1></div>
                <div><h1 id="mongolianChess" onclick="selectMode(this,'mongolianChess')" class="gameMode">Mongolian Chess</h1></div>
                <div><h1 id="randomchess" onclick="selectMode(this,'randomchess')" class="gameMode">Randomized Mini Chess</h1></div> -->
                <button class="createButton" onclick="startNewGame()">Start</button>
            </div>
        </div>

        <div id="games" class="games">

        </div>

        <div class="hotseat">
            <h1 style="text-align:center;">Pick White Race</h1>

            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedWhite', 'medieval')" src="/static/whiteClown.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedWhite', 'bug')" src="/static/whiteAnt.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedWhite', 'classic')" src="/static/whiteKing.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedWhite', 'cyborgs')" src="/static/whiteCrystal.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedWhite', 'promoters')" src="/static/whiteNorthernKing.png" alt="">
            <!-- <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedWhite', 'cat')" src="/static/whiteBlindCat.png" alt=""> -->

            <h1 style="text-align:center;">Pick Black Race</h1>

            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedBlack', 'medieval')" src="/static/blackClown.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedBlack', 'bug')" src="/static/blackAnt.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedBlack', 'classic')" src="/static/blackKing.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedBlack', 'cyborgs')" src="/static/blackCrystal.png" alt="">
            <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedBlack', 'promoters')" src="/static/blackNorthernKing.png" alt="">
            <!-- <img class="racePickImage" onclick="cleanSelect(this, 'racePickImageSelectedBlack', 'cat')" src="/static/blackBlindCat.png" alt=""> -->


            <div class="marginMedium">
                <a class="startGame column" onclick="hotseatGameStart()">Start Game</a>
            </div>
        </div>

        <div class="pieces">
            <pieces-game></pieces-game>
        </div>

        </gallery-game>
    </div>

      
      <!-- <div class="text"><h1>After a Millenium of suspense, the second version of everyones favourite Game is here. </h1>
    
                        <h1 style="font-size:5vh; text-align:center;">CHESS 2</h1>
            </div> -->


</body>
</html>